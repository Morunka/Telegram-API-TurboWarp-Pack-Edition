# Telegram Extensions for TurboWarp/PenguinMod

Этот репозиторий содержит набор расширений для работы с Telegram API в средах TurboWarp и PenguinMod. Они предназначены для управления ботами, отправки сообщений, обработки реакций, платежей, управления пользователями и конечными автоматами. Все расширения совместимы с TurboWarp и PenguinMod.

## Установка
1. Скопируйте код каждого расширения в отдельный `.js` файл.
2. Загрузите их в TurboWarp или PenguinMod через меню расширений.
3. Убедитесь, что у вас есть токен Telegram-бота (задаётся в `Telegram Core` или через `shared.token`).

## Расширения

### 1. Telegram Core
**Описание:** Базовое расширение для настройки Telegram-бота и получения обновлений.  
**Версия:** 1.0  
**Цвет:** `#0099CC`  
**Блоки:**
- `установить токен [TOKEN]` — задаёт токен бота.
- `последнее обновление` — возвращает JSON последнего обновления (`shared.lastUpdate`).
- `когда получено обновление` — шапка, срабатывает при новом обновлении в `shared.updates`.

**Примечания:** Основа для всех остальных расширений. Хранит токен в `shared.token` и обновления в `shared.updates`.

---

### 2. Telegram Messages
**Описание:** Отправка, редактирование и удаление сообщений с поддержкой массива фото.  
**Версия:** 1.6  
**Цвет:** `#00AADD`  
**Блоки:**
- `отправить [TEXT] в чат [CHATID] с кнопками [BUTTONS] и фото из массива` — отправляет сообщение с текстом, кнопками и фото (до 10).
- `добавить в массив фото [PHOTO]` — добавляет URL фото в массив.
- `сбросить массив фото` — сбрасывает массив фото.
- `изменить сообщение [MESSAGEID] в чате [CHATID] на [TEXT] с кнопками [BUTTONS] и фото [PHOTO]` — редактирует сообщение.
- `удалить сообщение [MESSAGEID] в чате [CHATID]` — удаляет сообщение.
- `последняя ошибка` — возвращает текст последней ошибки.

**Примечания:** Использует `sendMediaGroup` для нескольких фото и `sendPhoto` для одного. Требует валидные URL для фото.

---

### 3. Telegram Buttons
**Описание:** Управление кнопками в сообщениях Telegram.  
**Версия:** 1.0  
**Цвет:** `#66CCFF`  
**Блоки:**
- `добавить кнопку [TEXT] с данными [DATA] в строку [ROW]` — добавляет кнопку в массив кнопок.
- `сбросить кнопки` — сбрасывает массив кнопок.
- `получить массив кнопок` — возвращает JSON массива кнопок для использования в `Telegram Messages`.

**Примечания:** Работает в связке с `Telegram Messages`. Кнопки хранятся локально и передаются как `inline_keyboard`.

---

### 4. Telegram Users
**Описание:** Управление пользователями в чатах Telegram.  
**Версия:** 1.0  
**Цвет:** `#99CCFF`  
**Блоки:**
- `забанить пользователя [USERID] в чате [CHATID]` — банит пользователя.
- `разбанить пользователя [USERID] в чате [CHATID]` — разбанит пользователя.
- `последняя ошибка` — возвращает текст последней ошибки.

**Примечания:** Требует прав администратора у бота в чате.

---

### 5. Telegram Extras
**Описание:** Дополнительные функции: правила, inline-запросы, платежи и предоплата.  
**Версия:** 2.2  
**Цвет:** `#CCEEFF`  
**Блоки:**
- `установить правила [RULES]` — задаёт текст правил.
- `получить правила` — возвращает текущие правила.
- `отправить счёт в [CHATID] заголовок [TITLE] описание [DESC] токен [PROVIDER] валюта [CURRENCY] цены [PRICES]` — отправляет счёт.
- `ответить на inline [INLINEID] результаты [RESULTS]` — отвечает на inline-запрос.
- `последний inline запрос` — возвращает текст последнего inline-запроса.
- `когда получен inline запрос` — шапка для inline-запросов.
- `имя по ID [USERID]` — возвращает имя пользователя по ID.
- `отображаемое имя по ID [USERID]` — возвращает полное имя по ID.
- `подтвердить предоплату с ID [PRECHECKOUTID] успешно [SUCCESS] с ошибкой [ERROR]` — подтверждает/отклоняет предоплату.
- `когда оплата прошла` — шапка для успешной оплаты.
- `когда запрос оплаты получен` — шапка для запроса предоплаты.
- `ID последнего запроса предоплаты` — возвращает ID последнего `pre_checkout_query`.
- `содержание последнего запроса предоплаты` — возвращает JSON запроса предоплаты.
- `последняя ошибка` — возвращает текст последней ошибки.

**Примечания:** Для оплаты нужен токен провайдера (кроме XTR). Шапки зависят от `shared.updates`.

---

### 6. Telegram Reactions
**Описание:** Управление реакциями на сообщения в Telegram.  
**Версия:** 1.3  
**Цвет:** `#FFCC33`  
**Блоки:**
- `установить реакцию [EMOJI] на сообщение [MESSAGEID] в чате [CHATID]` — ставит реакцию.
- `убрать реакцию с сообщения [MESSAGEID] в чате [CHATID]` — убирает реакцию.
- `реакции на сообщение [MESSAGEID] в чате [CHATID]` — возвращает список установленных реакций.
- `последняя ошибка` — возвращает текст последней ошибки.

**Примечания:** Реакции отслеживаются локально. Требуются права бота на управление реакциями.

---

### 7. Finite State Machine (FSM)
**Описание:** Управление состояниями бота с помощью конечного автомата.  
**Версия:** 1.1  
**Цвет:** `#FF6666`  
**Блоки:**
- `установить состояние [STATE]` — задаёт текущее состояние.
- `текущее состояние` — возвращает текущее состояние.
- `когда состояние [STATE]` — шапка, срабатывает при указанном состоянии.
- `установить контекст [KEY] = [VALUE]` — задаёт значение в контексте.
- `получить контекст [KEY]` — возвращает значение из контекста.
- `сбросить контекст` — сбрасывает контекст.

**Примечания:** Полезно для управления логикой бота через состояния и контекст.

---

## Зависимости
- Все расширения используют `window.TelegramShared` для обмена данными (токен, обновления).
- `Telegram Core` обязателен для работы остальных расширений, если они используют `shared.token` или `shared.updates`.

## Использование
1. Настройте токен бота через `Telegram Core`.
2. Используйте `Telegram Messages` для отправки сообщений и фото.
3. Добавляйте кнопки через `Telegram Buttons`.
4. Управляйте пользователями с помощью `Telegram Users`.
5. Настройте платежи и inline-запросы через `Telegram Extras`.
6. Управляйте реакциями с `Telegram Reactions`.
7. Организуйте логику бота с `FSM`.

## Пример
```javascript
// Пример в TurboWarp/PenguinMod
установить токен [YOUR_BOT_TOKEN]
отправить счёт в [123456789] заголовок [Тест] описание [Тестовый счёт] токен [] валюта [XTR] цены [{"label": "Тест", "amount": 50}]
когда запрос оплаты получен
  подтвердить предоплату с ID [ID последнего запроса предоплаты] успешно [true] с ошибкой []
когда оплата прошла
  отправить [Оплата прошла!] в чат [123456789] с кнопками [[]] и фото из массива
